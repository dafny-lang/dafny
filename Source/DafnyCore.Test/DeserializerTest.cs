using Microsoft.Dafny;

namespace DafnyCore.Test;

public class DeserializerTest {
  [Fact]
  public async Task Fibonacci() {
    var input =
      "1; \"string:///test.java\" 1; ClassDecl 5; 2; 53; 3; 5; 2; 5; 2; 5; 2; 5; 2; \"FibonacciInvalid\" null 0; 3; Function 6; 6; 10; 7; 8; 33; 8; 33; 8; 33; 8; 33; \"Spec\" null true false 0; 1; 8; 38; 8; 59; 8; 58; 8; 58; 8; 58; 8; 58; \"n\" UserDefinedType 8; 54; 8; 57; 8; 54; NameSegment 8; 54; 8; 57; 8; 54; \"nat\" null false true null null false false false null 0; 0; 6; 6; 10; 7; 8; 33; 0; null 6; 6; 10; 7; 8; 33; 0; null false null UserDefinedType 8; 29; 8; 32; 8; 29; NameSegment 8; 29; 8; 32; 8; 29; \"nat\" null ITEExpr 9; 17; 9; 54; 9; 23; false BinaryExpr 9; 17; 9; 22; 9; 19; 7; NameSegment 9; 17; 9; 18; 9; 17; \"n\" null LiteralExpr 9; 21; 9; 22; 9; 21; Int32 2; NameSegment 9; 25; 9; 26; 9; 25; \"n\" null BinaryExpr 9; 29; 9; 54; 9; 41; 16; ApplySuffix 9; 29; 9; 40; 9; 33; NameSegment 9; 29; 9; 33; 9; 29; \"Spec\" null null 9; 29; 9; 40; 9; 33; 1; 9; 29; 9; 40; 9; 33; null BinaryExpr 9; 34; 9; 39; 9; 36; 17; NameSegment 9; 34; 9; 35; 9; 34; \"n\" null LiteralExpr 9; 38; 9; 39; 9; 38; Int32 1; false 9; 40; ApplySuffix 9; 43; 9; 54; 9; 47; NameSegment 9; 43; 9; 47; 9; 43; \"Spec\" null null 9; 43; 9; 54; 9; 47; 1; 9; 43; 9; 54; 9; 47; null BinaryExpr 9; 48; 9; 53; 9; 50; 17; NameSegment 9; 48; 9; 49; 9; 48; \"n\" null LiteralExpr 9; 52; 9; 53; 9; 52; Int32 2; false 9; 54; null null null Method 12; 6; 37; 7; 12; 29; 12; 29; 12; 29; 12; 29; \"Implementation\" null true false 0; 1; 12; 44; 12; 54; 12; 53; 12; 53; 12; 53; 12; 53; \"n\" UserDefinedType 12; 49; 12; 52; 12; 49; NameSegment 12; 49; 12; 52; 12; 49; \"nat32\" null false true null null false false false null 1; BinaryExpr 14; 19; 14; 40; 14; 27; 8; ApplySuffix 14; 19; 14; 26; 14; 23; NameSegment 14; 19; 14; 23; 14; 19; \"Spec\" null null 14; 19; 14; 26; 14; 23; 1; 14; 19; 14; 26; 14; 23; null NameSegment 14; 24; 14; 25; 14; 24; \"n\" null false 14; 26; LiteralExpr 14; 30; 14; 40; 14; 30; Int32 2147483647; null null 1; BinaryExpr 15; 33; 15; 45; 15; 35; 5; NameSegment 15; 33; 15; 34; 15; 33; \"r\" null ApplySuffix 15; 38; 15; 45; 15; 42; NameSegment 15; 38; 15; 42; 15; 38; \"Spec\" null null 15; 38; 15; 45; 15; 42; 1; 15; 38; 15; 45; 15; 42; null NameSegment 15; 43; 15; 44; 15; 43; \"n\" null false 15; 45; null null 12; 6; 37; 7; 12; 29; 0; null 12; 6; 37; 7; 12; 29; 0; null 1; 12; 25; 12; 28; 12; 25; 15; 18; 15; 45; 15; 18; \"r\" UserDefinedType 12; 25; 12; 28; 12; 25; NameSegment 12; 25; 12; 28; 12; 25; \"nat32\" null false false null null false false false null 12; 6; 37; 7; 12; 29; 0; null 12; 6; 37; 7; 12; 29; null 6; IfStmt 17; 10; 19; 11; 17; 10; null false BinaryExpr 17; 14; 17; 20; 17; 16; 5; NameSegment 17; 14; 17; 15; 17; 14; \"n\" null LiteralExpr 17; 19; 17; 20; 17; 19; Int32 0; 17; 22; 19; 11; 17; 22; null 1; ReturnStmt 18; 14; 18; 23; 18; 14; null 1; ExprRhs 18; 21; 18; 22; 18; 21; null LiteralExpr 18; 21; 18; 22; 18; 21; Int32 0; null VarDeclStmt 21; 10; 21; 33; 21; 14; null 1; 21; 10; 21; 33; 21; 14; \"previousResult\" UserDefinedType 21; 10; 21; 33; 21; 14; NameSegment 21; 10; 21; 33; 21; 14; \"int32\" null false AssignStatement 21; 31; 21; 32; 21; 31; null 1; IdentifierExpr 21; 10; 21; 33; 21; 14; \"previousResult\" 1; ExprRhs 21; 31; 21; 32; 21; 31; null LiteralExpr 21; 31; 21; 32; 21; 31; Int32 0; false VarDeclStmt 22; 10; 22; 25; 22; 14; null 1; 22; 10; 22; 25; 22; 14; \"result\" UserDefinedType 22; 10; 22; 25; 22; 14; NameSegment 22; 10; 22; 25; 22; 14; \"int32\" null false AssignStatement 22; 23; 22; 24; 22; 23; null 1; IdentifierExpr 22; 10; 22; 25; 22; 14; \"result\" 1; ExprRhs 22; 23; 22; 24; 22; 23; null LiteralExpr 22; 23; 22; 24; 22; 23; Int32 1; false VarDeclStmt 23; 10; 23; 20; 23; 14; null 1; 23; 10; 23; 20; 23; 14; \"i\" UserDefinedType 23; 10; 23; 20; 23; 14; NameSegment 23; 10; 23; 20; 23; 14; \"int32\" null false AssignStatement 23; 18; 23; 19; 23; 18; null 1; IdentifierExpr 23; 10; 23; 20; 23; 14; \"i\" 1; ExprRhs 23; 18; 23; 19; 23; 18; null LiteralExpr 23; 18; 23; 19; 23; 18; Int32 1; false WhileStmt 24; 10; 35; 11; 24; 10; null 3; BinaryExpr 26; 24; 26; 41; 26; 31; 5; NameSegment 26; 24; 26; 30; 26; 24; \"result\" null ApplySuffix 26; 34; 26; 41; 26; 38; NameSegment 26; 34; 26; 38; 26; 34; \"Spec\" null null 26; 34; 26; 41; 26; 38; 1; 26; 34; 26; 41; 26; 38; null NameSegment 26; 39; 26; 40; 26; 39; \"i\" null false 26; 41; null null BinaryExpr 27; 24; 27; 53; 27; 39; 5; NameSegment 27; 24; 27; 38; 27; 24; \"previousResult\" null ApplySuffix 27; 42; 27; 53; 27; 46; NameSegment 27; 42; 27; 46; 27; 42; \"Spec\" null null 27; 42; 27; 53; 27; 46; 1; 27; 42; 27; 53; 27; 46; null BinaryExpr 27; 47; 27; 52; 27; 49; 17; NameSegment 27; 47; 27; 48; 27; 47; \"i\" null LiteralExpr 27; 51; 27; 52; 27; 51; Int32 1; false 27; 53; null null BinaryExpr 28; 24; 28; 30; 28; 26; 8; NameSegment 28; 24; 28; 25; 28; 24; \"i\" null NameSegment 28; 29; 28; 30; 28; 29; \"n\" null null null 24; 10; 35; 11; 24; 10; 0; null 24; 10; 35; 11; 24; 10; 0; null 24; 10; 35; 11; 24; 10; null 5; AssignStatement 30; 18; 30; 23; 30; 20; null 1; NameSegment 30; 14; 30; 15; 30; 14; \"i\" null 1; ExprRhs 30; 18; 30; 23; 30; 20; null BinaryExpr 30; 18; 30; 23; 30; 20; 16; NameSegment 30; 18; 30; 19; 30; 18; \"i\" null LiteralExpr 30; 22; 30; 23; 30; 22; Int32 1; false AssignStatement 31; 14; 31; 37; 31; 14; null 0; 1; ExprRhs 31; 14; 31; 36; 31; 30; null ApplySuffix 31; 14; 31; 36; 31; 30; NameSegment 31; 14; 31; 30; 31; 14; \"SpecIsIncreasing\" null null 31; 14; 31; 37; 31; 14; 2; 31; 14; 31; 37; 31; 14; null NameSegment 31; 31; 31; 32; 31; 31; \"i\" null false 31; 14; 31; 37; 31; 14; null NameSegment 31; 34; 31; 35; 31; 34; \"n\" null false null false VarDeclStmt 32; 14; 32; 53; 32; 18; null 1; 32; 14; 32; 53; 32; 18; \"addition\" UserDefinedType 32; 14; 32; 53; 32; 18; NameSegment 32; 14; 32; 53; 32; 18; \"int32\" null false AssignStatement 32; 29; 32; 52; 32; 36; null 1; IdentifierExpr 32; 14; 32; 53; 32; 18; \"addition\" 1; ExprRhs 32; 29; 32; 52; 32; 36; null BinaryExpr 32; 29; 32; 52; 32; 36; 16; NameSegment 32; 29; 32; 35; 32; 29; \"result\" null NameSegment 32; 38; 32; 52; 32; 38; \"previousResult\" null false AssignStatement 33; 31; 33; 37; 33; 31; null 1; NameSegment 33; 14; 33; 28; 33; 14; \"previousResult\" null 1; ExprRhs 33; 31; 33; 37; 33; 31; null NameSegment 33; 31; 33; 37; 33; 31; \"result\" null false AssignStatement 34; 23; 34; 31; 34; 23; null 1; NameSegment 34; 14; 34; 20; 34; 14; \"result\" null 1; ExprRhs 34; 23; 34; 31; 34; 23; null NameSegment 34; 23; 34; 31; 34; 23; \"addition\" null false BinaryExpr 24; 16; 24; 21; 24; 18; 7; NameSegment 24; 16; 24; 17; 24; 16; \"i\" null NameSegment 24; 20; 24; 21; 24; 20; \"n\" null ReturnStmt 36; 10; 36; 24; 36; 10; null 1; ExprRhs 36; 17; 36; 23; 36; 17; null NameSegment 36; 17; 36; 23; 36; 17; \"result\" null null false Method 39; 6; 52; 7; 40; 18; 40; 18; 40; 18; 40; 18; \"SpecIsIncreasing\" null true false 0; 2; 40; 35; 40; 56; 40; 55; 40; 55; 40; 55; 40; 55; \"i\" UserDefinedType 40; 51; 40; 54; 40; 51; NameSegment 40; 51; 40; 54; 40; 51; \"nat\" null false true null null false false false null 40; 58; 40; 79; 40; 78; 40; 78; 40; 78; 40; 78; \"j\" UserDefinedType 40; 74; 40; 77; 40; 74; NameSegment 40; 74; 40; 77; 40; 74; \"nat\" null false true null null false false false null 1; BinaryExpr 42; 19; 42; 25; 42; 21; 8; NameSegment 42; 19; 42; 20; 42; 19; \"i\" null NameSegment 42; 24; 42; 25; 42; 24; \"j\" null null null 1; BinaryExpr 43; 18; 43; 36; 43; 26; 8; ApplySuffix 43; 18; 43; 25; 43; 22; NameSegment 43; 18; 43; 22; 43; 18; \"Spec\" null null 43; 18; 43; 25; 43; 22; 1; 43; 18; 43; 25; 43; 22; null NameSegment 43; 23; 43; 24; 43; 23; \"i\" null false 43; 25; ApplySuffix 43; 29; 43; 36; 43; 33; NameSegment 43; 29; 43; 33; 43; 29; \"Spec\" null null 43; 29; 43; 36; 43; 33; 1; 43; 29; 43; 36; 43; 33; null NameSegment 43; 34; 43; 35; 43; 34; \"j\" null false 43; 36; null null 39; 6; 52; 7; 40; 18; 0; null 39; 6; 52; 7; 40; 18; 0; null 0; 39; 6; 52; 7; 40; 18; 0; null 39; 6; 52; 7; 40; 18; null 2; VarDeclStmt 45; 10; 45; 36; 45; 30; null 1; 45; 10; 45; 36; 45; 30; \"x\" UserDefinedType 45; 10; 45; 36; 45; 30; NameSegment 45; 10; 45; 36; 45; 30; \"nat\" null false AssignStatement 45; 34; 45; 35; 45; 34; null 1; IdentifierExpr 45; 10; 45; 36; 45; 30; \"x\" 1; ExprRhs 45; 34; 45; 35; 45; 34; null NameSegment 45; 34; 45; 35; 45; 34; \"i\" null false WhileStmt 46; 10; 51; 11; 46; 10; null 2; BinaryExpr 48; 24; 48; 30; 48; 26; 8; NameSegment 48; 24; 48; 25; 48; 24; \"x\" null NameSegment 48; 29; 48; 30; 48; 29; \"j\" null null null BinaryExpr 49; 24; 49; 42; 49; 32; 8; ApplySuffix 49; 24; 49; 31; 49; 28; NameSegment 49; 24; 49; 28; 49; 24; \"Spec\" null null 49; 24; 49; 31; 49; 28; 1; 49; 24; 49; 31; 49; 28; null NameSegment 49; 29; 49; 30; 49; 29; \"i\" null false 49; 31; ApplySuffix 49; 35; 49; 42; 49; 39; NameSegment 49; 35; 49; 39; 49; 35; \"Spec\" null null 49; 35; 49; 42; 49; 39; 1; 49; 35; 49; 42; 49; 39; null NameSegment 49; 40; 49; 41; 49; 40; \"x\" null false 49; 42; null null 46; 10; 51; 11; 46; 10; 0; null 46; 10; 51; 11; 46; 10; 0; null 46; 10; 51; 11; 46; 10; null 1; AssignStatement 50; 18; 50; 23; 50; 20; null 1; NameSegment 50; 14; 50; 15; 50; 14; \"x\" null 1; ExprRhs 50; 18; 50; 23; 50; 20; null BinaryExpr 50; 18; 50; 23; 50; 20; 16; NameSegment 50; 18; 50; 19; 50; 18; \"x\" null LiteralExpr 50; 22; 50; 23; 50; 22; Int32 1; false BinaryExpr 46; 16; 46; 21; 46; 18; 7; NameSegment 46; 16; 46; 17; 46; 16; \"x\" null NameSegment 46; 20; 46; 21; 46; 20; \"j\" null null false 0; false ";
    var options = DafnyOptions.Default;
    var reporter = new BatchErrorReporter(options);
    var parseResult = await ProgramParser.Parse(input, new Uri("file:///fib.dbin"), reporter);
    Assert.False(reporter.HasErrors);
  }
}